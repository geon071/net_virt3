# Домашнее задание к занятию «Микросервисы: подходы»

<details>
  <summary><b>Задача 1: Обеспечить разработку</b></summary>

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.
</details>

## Ответ

Для обеспечения процесса разработки рекомендую использовать следующие продукты: Git (GitLab, GitHub, Bitbucket), Docker, Jenkins/GitLab.

Система контроля версий Git и репозитории на каждый сервис позволит:

- Создавать и управлять отдельными репозиториями для каждого сервиса на выбранной Git-платформе (например, GitHub, GitLab или Bitbucket).
- Команда разработчиков сможет делать коммиты и пуши изменений в свой репозиторий.
- Возможность хранения секретных данных в зашифрованном виде. Если этого недостаточно, то можно рассмотреть использование Vault от HashiCorp, но потребуется затраты на настройку и поддержку хранилищ с секретами, но вариант более преподчтителен в части безопасности.

Сборка докер-образов для проектов (Docker) позволит разработчикам упаковывать приложение и его зависимости в контейнеры, что упрощает развертывание и управление проектом.

Непрерывная интеграция с использованием Jenkins или GitLab CI/CD:

- Настройка конвейеров непрерывной интеграции для автоматического запуска сборки при появлении новых коммитов в репозитории.
- Конфигурация событий из системы контроля версий для проверки изменений и запуска сборки.
- Создание шаблонов сборок для определенных конфигураций, которые можно повторно использовать при нескольких проектах или сервисах.
- Шаблоны могут содержать предварительно настроенные стадии сборки, деплоя и тестирования, а также установку необходимых зависимостей и запуск кастомных шагов.
- Возможность установки и настройки агентов сборки (например, Jenkins Agent или GitLab Runner) на собственных серверах, которые могут выполнять сборку проекта на локальных ресурсах.

Например:

- Каждый раз, когда командой разработчиков делается коммит и пуш в репозиторий, Jenkins или GitLab CI/CD, обнаруживает изменения и автоматически запускает сборку проекта.
- Далее запуск тестов для проверки артефакта полученного в ходе сборки
- После успешного прохождения тестов, выкладка полученного Docker образа в хранилище образов
- Запуск установки новой сборки сервиса на стенд.

<details>
  <summary><b>Задача 2: Логи</b></summary>

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.
</details>

## Ответ

Для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре можно использовать следующее решение: Elasticsearch, Logstash, Kibana (ELK стек). В микросервисах следует использовать стандартные библиотеки или фреймворки, которые позволяют направлять логи в stdout. Например, в языке Python это может быть библиотека logging.

Настройка агентов Logstash на каждом хосте сервисов:

- Logstash агенты, установленные на каждом хосте, прослушивают вывод в stdout и отправляют логи в хранилище Elasticsearch.
- Доставка логов по протоколу HTTPS over TCP

Пользовательский интерфейс Kibana позволит:

- Выполнять поиск и фильтрацию записей логов.
- Разработчикам получить доступ для поиска и анализа логов своих сервисов, а также создавать и сохранять запросы.

Почему ELK?

- ELK стек является популярным и широко используемым решением для сбора и анализа логов в микросервисной архитектуре. Он имеет большое сообщество поддержки и обширную документацию.
- Elasticsearch обеспечивает эффективное хранение, поиск и анализ больших объемов данных.
- Logstash предоставляет гибкие возможности для сбора и обработки данных логов.
- Kibana предоставляет удобный пользовательский интерфейс для поиска, визуализации и анализа логов.

<details>
  <summary><b>Задача 3: Мониторинг</b></summary>

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.
</details>

## Ответ

Для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре можно использовать следующее решение: Prometheus, Prometheus exporters (для сбора метрик состояни хоста использовать Node Exporter), Grafana, VictoriaMetrics.

Взаимодействие между этими продуктами может быть организовано следующим образом:

- Prometheus будет собирать метрики со всех хостов, обслуживающих систему, используя HTTP-запросы к специальным endpoint'ам на каждом хосте.
- Данные о метриках будут сохраняться в базе данных VictoriaMetrics.
- Grafana будет использоваться для отображения этих метрик в виде графиков и других типов диаграмм.

Почему именно такой выбор технологий ?

- Prometheus является современной системой мониторинга, которая специализируется на сборе и хранении временных рядов метрик. С помощью экспортеров (Prometheus exporters) можно получить метрики от различных ресурсов и сервисов.
- Grafana предоставляет мощные возможности для визуализации, анализа и агрегации метрик, собранных Prometheus. С помощью Grafana можно создавать пользовательские дашборды, настраивать панели с различными виджетами для отображения и анализа метрик.
- База данных VictoriaMetrics имеет встроенную поддержку Prometheus, что позволяет легко интегрировать ее в системы мониторинга. VictoriaMetrics имеет больше возможностей в эксплуатации нежели встроенная БД Prometheus, в части - производительность (благодаря оптимизированной структуре данных и использованию индексов, обеспечивает быстрый доступ к данным и быстрый поиск), экономия хранилища (эффективные алгоритмы сжатия для хранения метрик, позволяют сэкономить пространство на диске) и т.д.